<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inevisual - Sistema de Soberanía Multidimensional</title>
    <style>
        body, html { margin: 0; padding: 0; background: #000; color: #fff; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        
        .interface {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            pointer-events: none;
        }

        .panel {
            background: rgba(0, 0, 0, 0.85);
            padding: 40px;
            border-radius: 60px;
            border: 2px solid #FFD700;
            text-align: center;
            box-shadow: 0 0 50px #FFD700;
            pointer-events: auto;
            width: 350px;
            transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        h1 { font-weight: 200; letter-spacing: 8px; margin: 0; color: #FFD700; font-size: 1.8rem; }
        .sub-header { font-size: 0.6rem; letter-spacing: 3px; margin-bottom: 25px; color: #fff; opacity: 0.8; }
        
        #status { font-size: 0.85rem; height: 50px; color: #FFD700; margin-bottom: 20px; font-weight: bold; line-height: 1.4; }
        
        button.main-btn {
            background: transparent;
            border: 1px solid #FFD700;
            color: #FFD700;
            padding: 12px 25px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 0.9rem;
            transition: 0.3s;
        }

        button.main-btn:hover { background: #FFD700; color: #000; box-shadow: 0 0 20px #FFD700; }

        .bitacora { margin-top: 30px; border-top: 1px solid rgba(255,215,0,0.2); padding-top: 20px; }
        input {
            background: rgba(255,255,255,0.05);
            border: 1px solid #444;
            color: #fff;
            padding: 8px;
            width: 70%;
            font-size: 0.8rem;
            outline: none;
        }
        input:focus { border-color: #FFD700; }
        
        #logs {
            margin-top: 15px;
            height: 80px;
            overflow-y: hidden;
            color: #00D4FF;
            text-align: left;
            font-size: 0.7rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="interface">
        <div class="panel" id="main-panel">
            <h1>INEVISUAL</h1>
            <div class="sub-header">SOBERANÍA MULTIDIMENSIONAL</div>
            
            <div id="status">SISTEMA LATENTE<br>Esperando Anclaje de Realidad...</div>
            
            <button class="main-btn" onclick="iniciarSistema()">Activar Blindaje</button>
            
            <div class="bitacora">
                <input type="text" id="log-input" placeholder="Anclar éxito o abundancia...">
                <button onclick="anclar()" style="padding: 7px 12px; font-size: 0.6rem; background: #FFD700; color: #000; border: none; cursor: pointer;">ANCLAR</button>
                <div id="logs"></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let audioCtx, osc, gain, angle = 0;
        let modoActual = 'soberania'; // Modos: soberania (Merkabah), abundancia (Toroide), proteccion (Metatrón)

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // --- MOTOR DE GEOMETRÍA SAGRADA ---
        function drawGeometry() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.08)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const cx = canvas.width / 2;
            const cy = canvas.height / 2;
            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(angle);
            ctx.lineWidth = 1.2;

            if (modoActual === 'abundancia') {
                // TOROIDE (888Hz - Dinero y Flujo)
                ctx.strokeStyle = '#FFD700';
                for (let i = 0; i < 30; i++) {
                    ctx.rotate(Math.PI / 15);
                    ctx.beginPath();
                    ctx.ellipse(40, 0, 130, 220, 0, 0, Math.PI * 2);
                    ctx.stroke();
                }
            } else if (modoActual === 'proteccion') {
                // CUBO DE METATRÓN (417Hz - Anti-Acoso)
                ctx.strokeStyle = '#9B59B6';
                const r = 160;
                for (let i = 0; i < 6; i++) {
                    let x = r * Math.cos(i * Math.PI / 3);
                    let y = r * Math.sin(i * Math.PI / 3);
                    ctx.beginPath(); ctx.arc(x, y, 60, 0, Math.PI * 2); ctx.stroke();
                    for (let j = 0; j < 6; j++) {
                        ctx.beginPath(); ctx.moveTo(x, y);
                        ctx.lineTo(r * Math.cos(j * Math.PI / 3), r * Math.sin(j * Math.PI / 3));
                        ctx.stroke();
                    }
                }
            } else {
                // MERKABAH (528Hz - Soberanía y Libertad)
                ctx.strokeStyle = '#00D4FF';
                for(let i = 0; i < 2; i++) {
                    ctx.rotate(Math.PI);
                    ctx.beginPath();
                    ctx.moveTo(0, -180);
                    ctx.lineTo(150, 100);
                    ctx.lineTo(-150, 100);
                    ctx.closePath();
                    ctx.stroke();
                }
            }

            ctx.restore();
            angle += 0.005;
            requestAnimationFrame(drawGeometry);
        }

        // --- LÓGICA DE CONTROL ---
        async function iniciarSistema() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                osc = audioCtx.createOscillator();
                gain = audioCtx.createGain();
                
                osc.type = 'sine';
                gain.gain.setValueAtTime(0.04, audioCtx.currentTime);
                
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start();
                
                sincronizarConBackend();
            }
        }

        async function sincronizarConBackend() {
            try {
                const res = await fetch('/activar_portal');
                const data = await res.json();
                
                // Cambiar geometría según frecuencia
                if (data.frecuencia === 888) modoActual = 'abundancia';
                else if (data.frecuencia === 417) modoActual = 'proteccion';
                else modoActual = 'soberania';

                document.getElementById('status').innerHTML = `${data.nombre}<br><span style="font-size:0.7rem; font-weight:normal; opacity:0.8;">${data.mantra}</span>`;
                document.getElementById('main-panel').style.borderColor = data.color;
                document.getElementById('main-panel').style.boxShadow = `0 0 50px ${data.color}`;
                
                osc.frequency.exponentialRampToValueAtTime(data.frecuencia, audioCtx.currentTime + 2);
                
                cargarLogs();
            } catch (e) { console.log("Esperando conexión..."); }
            
            setTimeout(sincronizarConBackend, 10000);
        }

        async function anclar() {
            const val = document.getElementById('log-input').value;
            if(!val) return;
            await fetch('/guardar_log', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({texto: val, hora: new Date().toLocaleTimeString()})
            });
            document.getElementById('log-input').value = '';
            cargarLogs();
        }

        async function cargarLogs() {
            const res = await fetch('/obtener_logs');
            const data = await res.json();
            document.getElementById('logs').innerHTML = data.map(d => `<div>[${d.hora}] ${d.texto}</div>`).join('');
        }

        // Iniciar renderizado visual
        drawGeometry();
    </script>
</body>
</html>